@model Blogifier.Core.Data.Models.AdminSettingsModel
@using Blogifier.Core.Common
@using Blogifier.Core.Data.Domain
@using Blogifier.Core.Extensions
@{
    ViewData["Title"] = "Newsletter";
    Layout = ApplicationSettings.PkgSettingsLayout;

    var result = ComponentHelper.GetValue(Model.Settings, "Emails");
    var pager = ComponentHelper.GetValue(Model.Settings, "Pager");

    var emails = (IEnumerable<Subscriber>)result;
    var pgr = (Pager)pager;

    var cntFrom = pgr.CurrentPage == 1 ? 1 : (pgr.CurrentPage - 1) * pgr.ItemsPerPage + 1;
    var cntTo = pgr.CurrentPage * pgr.ItemsPerPage < pgr.Total ? pgr.CurrentPage * pgr.ItemsPerPage : pgr.Total;
}

<!-- Toolbar -->
<div class="bf-toolbar d-flex align-items-center" style="padding: 0 2rem">
    <label class="custom-control custom-checkbox custom-control-single mr-3">
        <input class="custom-control-input item-checkbox" type="checkbox" id="selectAll" name="selectAll">
        <span class="item-control custom-control-indicator"></span>
    </label>
    <div id="postActionButtons" class="btn-group mr-3">
        <button type="button" class="btn btn-outline-secondary btn-icon btn-sm btn-rounded" disabled="disabled" data-tooltip onclick="return newsletter.remove()" title="Remove">
            <i class="fa fa-trash"></i>
        </button>
    </div>
    <div class="loading loading-sm mr-3">
        <div class="loading-dot-1"></div>
        <div class="loading-dot-2"></div>
        <div class="loading-dot-3"></div>
    </div>
    <form class="bf-posts-form-search" action="~/blogifier/plugins/Emailer/settings" method="get">
        <input class="form-control form-control-sm form-control-rounded pull-right" type="search" name="search" placeholder="Search..." autocomplete="off" />
    </form>
</div>
<!--/Toolbar -->

@if (emails != null && emails.Any())
{
    <div class="row" style="width: 100%; margin-top: 10px; margin-bottom: 10px">
        <div class="col-md-1">&nbsp;</div>
        <div class="col-md-3"><label>Email</label></div>
        <div class="col-md-2"><label>Browser</label></div>
        <div class="col-md-2"><label>Device</label></div>
        <div class="col-md-1"><label>OS</label></div>
        <div class="col-md-1"><label>IP</label></div>
        <div class="col-md-2"><label>Last updated</label></div>
    </div>
    <ul class="bf-list d-block" aria-label="newsletter">
        @foreach (var item in emails)
        {
            <li class="bf-list-item d-flex align-items-center">
                <div class="row" style="width: 100%">
                    <div class="col-md-1">
                        <label class="bf-list-item-select custom-control custom-checkbox mr-3 my-auto">
                            <input type="checkbox" value="@item.Email" class="item-checkbox custom-control-input">
                            <span class="item-control custom-control-indicator"></span>
                        </label>
                    </div>
                    <div class="col-md-3">@item.Email</div>
                    <div class="col-md-2">@item.Browser</div>
                    <div class="col-md-2">@item.Device</div>
                    <div class="col-md-1">@item.Os</div>
                    <div class="col-md-1">@item.Ip</div>
                    <div class="col-md-2">@item.LastUpdated.ToFriendlyDateTimeString()</div>
                </div>
            </li>
        } 
    </ul>
}
else
{
    <div class="bf-list-empty">
        No subscribers found!
    </div>
}

<!-- Pagination -->
@if (pgr.ShowNewer || pgr.ShowOlder)
{
    <ul class="bf-pagination d-flex">
        @if (pgr.ShowOlder)
        {
            <li class="bf-pagination-item"><a class="bf-pagination-link" href="~/blogifier/plugins/Emailer/settings?page=@pgr.Older"><i class="bf-pagination-icon fa fa-chevron-left"></i></a></li>
        }
        @if (pgr.ShowNewer)
                {
            <li class="bf-pagination-item"><a class="bf-pagination-link" href="~/blogifier/plugins/Emailer/settings?page=@pgr.Newer"><i class="bf-pagination-icon fa fa-chevron-right"></i></a></li>
        }
        <li class="bf-pagination-item"><span class="bf-pagination-count">@cntFrom-@cntTo out of @pgr.Total</span></li>
    </ul>
}
<!--/Pagination -->

<script>
    var root = '@Url.Content("~/")';
</script>

@section Scripts{
    <script src="~/plugins/emailer/settings.js"></script>
}